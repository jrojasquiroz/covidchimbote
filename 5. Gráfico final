import pandas as pd
import matplotlib.dates as mdates
from matplotlib.dates import DateFormatter
from pandas.plotting import register_matplotlib_converters
register_matplotlib_converters()
import matplotlib.pyplot as plt

#1. Le ponemos un nombre al archivo: "xls"
xls=pd.ExcelFile('muertespandemiaNV_13abril.xlsx')

 #1.1. Vemos qué hojas hay
 print(xls.sheet_names) #solo hay una, llamada Sheet 1

 #1.2. Identificamos la hoja como el df a trabajar
 df=xls.parse('Sheet 1')

#2. Hacemos el gráfico
plt.plot( 'Fecha', 'MediaMovil_2019', data=df, marker='', color='black', linewidth=0.6, label="Muertes diarias 2019 (Media móvil de 7 días)")
plt.plot( 'Fecha', 'NumMuertes', data=df, marker='', color='#8A8A8A', linewidth=0.4, linestyle='--', label="Muertes diarias 2020-2021")
plt.plot( 'Fecha', 'ContagiosSieteDias', data=df, marker='', color='#BA312A', linewidth=1.5, label="Muertes diarias 2020-2021 (Media móvil de 7 días)")
#Aquí hay más info sobre cómo editar el gráfico
#https://stackoverflow.com/questions/9627686/plotting-dates-on-the-x-axis-with-pythons-matplotlib/9627970 (última respuesta)
#Significado de códigos para fechas https://estadisticamente.com/trabajando-con-fechas-en-r/
plt.gca().xaxis.set_major_formatter(mdates.DateFormatter('%d/%m')) 
plt.gca().xaxis.set_major_locator(mdates.DayLocator(interval=30)) #Importante el intervalo
plt.gcf().autofmt_xdate()#esto hace que las fechas alcancen en el área del gráfico (en este caso, rota el texto a 30°)
#plt.xticks(fontsize=8, rotation=45)#con esto le damos el giro exacto y el tamaño de letra que queremos
plt.xticks(fontsize=8)
plt.yticks(fontsize=8)


plt.title("SINADEF al 13 de abril",fontsize=8)
plt.suptitle("Muertes diarias por causa no violenta (Chimbote y Nuevo Chimbote)",fontsize=10)
#plt.legend(loc='lower center') #le pedimos que muestre la leyenda, forma n° 1
#plt.legend(['Example legend'],loc='upper center') #le pedimos que muestre la leyenda, forma n° 2
plt.gca().legend(loc='lower center', bbox_to_anchor=(0.5, -0.4), fontsize=8, frameon=False) #leyenda forma n° 3, más info: https://queirozf.com/entries/matplotlib-examples-displaying-and-configuring-legends

#le ponemos límite al eje X
plt.xlim('2020-01-01','2021-04-13') #más info: https://www.python-graph-gallery.com/191-custom-axis-on-matplotlib-chart

#plt.grid(True)
#plt.show()

#3. Guardamos
plt.savefig("13abril.png", facecolor='w', edgecolor='w', dpi= 250, bbox_inches="tight",  pad_inches=0.2, transparent = False) 
